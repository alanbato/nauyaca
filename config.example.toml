# Nauyaca Gemini Server Configuration
# Copy this file to config.toml and customize as needed

[server]
# Server host and port
host = "0.0.0.0"  # Bind to all interfaces (use "localhost" for local only)
port = 1965       # Default Gemini port

# Document root directory - where your gemini content is served from
document_root = "./capsule"

# TLS certificate and key (required for production)
# If omitted, a self-signed certificate will be generated automatically
# Note: Self-signed certificates are only suitable for testing!
certfile = "cert.pem"
keyfile = "key.pem"

# Example with absolute paths:
# certfile = "/etc/nauyaca/cert.pem"
# keyfile = "/etc/nauyaca/key.pem"

# Maximum file size to serve (in bytes)
# Default: 104857600 (100 MiB) per Gemini best practices
# Gemini is not designed for large file transfers
# max_file_size = 104857600

[rate_limit]
# Enable rate limiting to prevent DoS attacks
enabled = true

# Token bucket parameters
# Capacity: Maximum number of requests allowed in a burst
capacity = 10

# Refill rate: Tokens added per second (sustained request rate)
# 1.0 = 1 request per second sustained
# 2.0 = 2 requests per second sustained
refill_rate = 1.0

# Retry-after: Seconds client should wait when rate limited
# Sent in the status 44 response
retry_after = 30

[access_control]
# IP-based access control
# Both allow_list and deny_list support CIDR notation

# Allow list (whitelist mode)
# If set, ONLY these IPs/networks can connect
# Uncomment and customize to enable:
# allow_list = ["192.168.1.0/24", "10.0.0.5"]

# Deny list (blacklist mode)
# If set, these IPs/networks are blocked
# Uncomment and customize to enable:
# deny_list = ["203.0.113.0/24", "198.51.100.10"]

# Default policy when IP is not in any list
# true = allow all (default)
# false = deny all (requires allow_list to grant access)
default_allow = true

# Examples of access control configurations:

# Example 1: Allow only local network
# allow_list = ["127.0.0.0/8", "192.168.0.0/16", "10.0.0.0/8"]
# default_allow = false

# Example 2: Block specific abusive IPs
# deny_list = ["198.51.100.0/24"]
# default_allow = true

# Example 3: Private server (localhost only)
# allow_list = ["127.0.0.1"]
# default_allow = false

# Path-based certificate authentication per Gemini application best practices.
# Certificates are activated for specific URL prefixes rather than globally,
# allowing public and authenticated content to coexist on the same server.
#
# Each [[certificate_auth.paths]] entry defines a rule for a path prefix.
# Rules are checked in order - first matching rule applies.
# If no rule matches, the request is allowed without certificate requirements.

# Example 1: Require any client certificate for /app/ paths
# [[certificate_auth.paths]]
# prefix = "/app/"
# require_cert = true

# Example 2: Require specific certificate fingerprints for admin paths
# [[certificate_auth.paths]]
# prefix = "/admin/"
# require_cert = true
# allowed_fingerprints = [
#   "sha256:a1b2c3d4e5f6...",
#   "sha256:1234567890ab...",
# ]

# Example 3: Allow public access to /app/public/ (put before /app/ rule)
# [[certificate_auth.paths]]
# prefix = "/app/public/"
# require_cert = false

# Example 4: Complete path-based auth setup:
# [[certificate_auth.paths]]
# prefix = "/app/public/"    # Public area - no cert needed
# require_cert = false
#
# [[certificate_auth.paths]]
# prefix = "/app/"           # Main app - any cert accepted
# require_cert = true
#
# [[certificate_auth.paths]]
# prefix = "/admin/"         # Admin - specific certs only
# require_cert = true
# allowed_fingerprints = ["sha256:admin-cert-hash..."]

[logging]
# Privacy-preserving logging configuration

# Hash client IP addresses in logs (recommended for privacy)
# When enabled, IP addresses are replaced with SHA-256 hashes
# This allows abuse detection while protecting user privacy
hash_ips = true
